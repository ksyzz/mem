/*!
 * svg v1.0.0
 * Copyright 2017.12, Inc.
 * Producer chenglong
 */
(function(){var v=Snap("#svg");var u=document.querySelector(".action-show"),q=document.querySelector(".create-shape"),p=document.querySelector(".create"),n=document.querySelector(".face"),E=document.querySelector(".hengshu"),s=document.querySelector(".transform"),z=null,f=0,y=0,w=0,H=document.getElementById("translate-x"),G=document.getElementById("translate-y"),F=document.getElementById("scale"),B=document.getElementById("rotate"),o=50,D=5,r=10,k=30,t=1,l="text",j=0,e=0,c=0,h="http://www.w3.org/2000/svg",d={rect:"50, 50, 10, 30, 0",image:"200,200,50",line:"50,50,150,50",text:"50,50"},A={fill:"#fff",stroke:"#007fff"};var b=v.paper.path("M2,2 L2,8 L9,5 L2,2").attr({fill:"#FF0000"});var a=b.marker(0,0,13,13,2,5);v.paper.click(function(J){if(J.target.tagName.toLowerCase() in d){document.getElementById("xz").innerHTML="";z=Snap(J.target);z.drag();var I=d[J.target.tagName].split(",");if(J.target.tagName=="line"){o=Snap(J.target).attr("x2");D=parseInt(Snap(J.target).attr("strokeWidth"))}else{if(J.target.tagName=="rect"){r=parseInt(Snap(J.target).attr("width"));k=parseInt(Snap(J.target).attr("height"))}else{if(J.target.tagName=="image"){r=parseInt(Snap(J.target).attr("width"));k=parseInt(Snap(J.target).attr("height"))}}}x(J.target.tagName,J.target.tagName,I);e=Snap(z).matrix.e;c=Snap(z).matrix.f}if(J.target.tagName.toLowerCase()=="image"){$(".ihide").hide()}else{$(".ihide").show()}$("#fill").val(C(Snap(z).attr("fill")));$("#stroke").val(C(Snap(z).attr("stroke")));$("#stroke-width").val(parseInt(Snap(z).attr("strokeWidth")))});$(document).bind("keydown",function(J){if(J.which==46){if(z==""){alert("请选中图中元素");return n}var I=confirm("是否删除该元素");if(I==true){Snap(z).remove();z=""}else{}}});var i=new Clipboard("#fuzhi",{text:function(){return $(".action-show").html()}});i.on("success",function(I){alert("成功复制！")});i.on("error",function(I){alert("复制失败！")});$("#save").click(function(){window.localStorage.setItem("vhtml",$("#svg").html());alert("保存成功！")});$("#qingchu").click(function(){window.localStorage.removeItem("vhtml");alert("清除成功！")});$("#clear").click(function(){$("#svg").html("")});$(".selectChange").bind("change",function(I){if($(this).val()=="image"){$(".ihide").hide()}else{$(".ihide").show()}$(".changeName").attr({id:$(this).val(),sname:$(".selectChange").find("option:selected").attr("t"),})});p.addEventListener("click",g,false);function g(K){if(K.target.tagName.toLowerCase()==="button"){var I=K.target.id;var J=$(K.target).attr("sname");m(I,J)}}function m(L,K){var P=d[L].split(",");q.innerHTML="";var M,I,O;var N="img/"+K+".svg";if(L=="line"){z=v.paper.line(P[0],P[1],P[2],P[3]).attr({fill:"#f00",stroke:"#ff0000",strokeWidth:5,}).drag()}else{if(L=="rect"){z=v.paper.rect(P[0],P[1],P[2],P[3],P[4]).attr({fill:"#f00",stroke:"#f00"}).drag()}else{if(L=="text"){var J='"'+(new Date().getTime())+'"';var Q="D"+J.substring(8,13);j=j+1;z=v.paper.text(P[0],P[1],l).attr({dataid:Q,id:"text"+j}).attr({fill:"#f00",stroke:"#f00"}).drag()}else{if(L=="image"){z=v.paper.image(N,10,10,80,80).drag()}}}}O=P;x(L,L,O)}function x(I,J,M){var L=document.createElement("div");if(I=="line"){L.innerHTML='<button type="button" class="hengshu">横竖转换</button><button type="button" class="jiantou">加箭头</button><label>长 <input type="range" min="1" max="800" value="'+o+'" name="chang" /><span class="changS">'+o+'</span></label><label>宽 <input type="range" min="1" max="50" value="'+D+'" name="kuan" /><span class="kuanS">'+D+"</span></label>"}else{if(I=="rect"){var K="空心";if(Snap(z).attr("fill-opacity")==0){var K="实心"}L.innerHTML='<button type="button" class="kongxin">'+K+'</button><label>宽 <input type="range" min="1" max="500" value="'+r+'" name="chang" /><span class="changS">'+r+'</span></label><label>高 <input type="range" min="1" max="500" value="'+k+'" name="kuan" /><span class="kuanS">'+k+"</span></label>"}else{if(I=="image"){L.innerHTML='<label>大小 <input type="range" min="1" max="200" value="'+r+'" name="chang" /></label><label>旋转 <input type="range" min="1" max="4" value="'+t+'" name="kuan" /></label>'}else{if(I=="text"){if(Snap(z).attr("text")!="text"){l=Snap(z).attr("text")}if(Snap(z).attr("font-size")){r=parseInt(Snap(z).attr("font-size"))}L.innerHTML='<label>大小 <input type="range" min="1" max="200" value="'+r+'" name="chang" /><span class="changS">'+r+'</span></label><label>文字 <input type="text" maxlength="30" value="'+l+'" name="kuan" /></label>'}}}}q.appendChild(L)}$("#zindex_1").click(function(){var I=document.getElementById("svg").lastChild;Snap(I).after(Snap(z))});$("#zindex_2").click(function(){var I=document.getElementById("svg").firstElementChild;Snap(I).before(Snap(z))});q.addEventListener("input",function(I){if(I.target.tagName.toLowerCase()==="input"){if(z.type=="line"){if(I.target.name=="chang"){$(".changS").text(parseInt(I.target.value)+50);Snap(z).attr({x2:parseInt(I.target.value)+50,})}else{if(I.target.name=="kuan"){$(".kuanS").text(parseInt(I.target.value));Snap(z).attr({strokeWidth:parseInt(I.target.value),})}}}else{if(z.type=="rect"){if(I.target.name=="chang"){$(".changS").text(parseInt(I.target.value));Snap(z).attr({width:parseInt(I.target.value),})}else{if(I.target.name=="kuan"){$(".kuanS").text(parseInt(I.target.value));Snap(z).attr({height:parseInt(I.target.value),})}}}else{if(z.type=="text"){if(I.target.name=="chang"){$(".changS").text(parseInt(I.target.value));Snap(z).attr({fontSize:parseInt(I.target.value),})}else{if(I.target.name=="kuan"){Snap(z).attr({text:I.target.value,})}}}else{if(z.type=="image"){if(I.target.name=="chang"){Snap(z).attr({width:parseInt(I.target.value),height:parseInt(I.target.value)})}else{if(I.target.name=="kuan"){var J=0;if(I.target.value>1&&I.target.value<=2){J=90}else{if(I.target.value>2&&I.target.value<=3){J=180}else{if(I.target.value>3&&I.target.value<=4){J=270}else{J=360}}}Snap(z).transform(new Snap.Matrix().translate(e,c).rotate(J,Snap(z).attr("width")/2,Snap(z).attr("height")/2))}}}}}}}},false);$(document).on("click",".hengshu",function(I){if($(this).attr("t")==1){Snap(z).transform(new Snap.Matrix().translate(e,c).rotate(0,50,50));$(this).removeAttr("t")}else{$(this).attr("t","1");Snap(z).transform(new Snap.Matrix().translate(e,c).rotate(90,50,50))}});$(document).on("click",".jiantou",function(I){Snap(z).attr({"marker-end":a})});$(document).on("click",".kongxin",function(I){if(Snap(z).attr("fill-opacity")==0){$(this).text("空心");Snap(z).attr({"fill-opacity":1})}else{$(this).text("实心");Snap(z).attr({"fill-opacity":0})}});n.addEventListener("input",function(I){if(!z){alert("请先创建图形");return}if(I.target.tagName.toLowerCase()==="input"){var J=I.target.id;switch(J){case"fill":Snap(z).attr({fill:I.target.value,});break;case"stroke":Snap(z).attr({stroke:I.target.value,});break;case"stroke-width":Snap(z).attr({strokeWidth:I.target.value,});break}}},false);$(document).ready(function(){if(window.localStorage.getItem("vhtml")!=null){$("#svg").html(window.localStorage.getItem("vhtml"))}});function C(P){var N=/[0-9]{0,3}/g;var Q=P.match(N);var R="#";var K=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];for(var M=0;M<Q.length;M++){var I=null,O=Q[M],L=O;var J=[];while(O>16){I=O%16;O=(O/16)>>0;J.push(K[I])}J.push(K[O]);if(L<16&&L!=""){J.push(0)}R+=J.reverse().join("")}return R}})();